<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChatGpt测试</title>
    <link rel="stylesheet" href="lib/element-ui/index.css">

    <style type="text/css">
        #outputCard{
            height: 300px;
            overflow:auto;
        }

        #inputCard{
            height: 100px;
            overflow:auto;
        }

    </style>

    <script src="lib/jquery/jquery-3.6.0.min.js"></script>
    <script src="lib/vue/vue.min.js"></script>
    <script src="lib/element-ui/index.js"></script>
</head>
<body>
<h1 align="center">ChatGpt测试</h1>

<div id="chatWindow">
    <el-row id="outputArea">
        <el-card id="inputCard">
            <div id="inputTxt">
            </div>
        </el-card>
        <el-card id="outputCard">
            <div id="outputTxt">
            </div>
        </el-card>
    </el-row>
    <el-row id="inputArea">
        <el-col :span="21">
            <el-input id="sendTxt" v-model="input" placeholder="请输入内容"></el-input>
        </el-col>
        <el-col :span="3">
            <el-button id="sendBtn" type="primary">发送消息</el-button>
        </el-col>
    </el-row>
</div>

</body>
<script type="text/javascript">

  //vue样式渲染到网页上
    var app = new Vue({
      el: '#chatWindow',
      data: {
          input: ''
      },
      mounted: function(){

      },
      methods: {
      }
    })

 //点击事件
 $('#sendBtn').click(function(){
     $('#outputTxt').html('');
     var sendTxt = $('#sendTxt').val();
     $('#inputTxt').html(sendTxt);
     $('#sendTxt').val('');

     //发送请求
     $.ajax({
        type: "post",
        url:"/chat/sendMsg",
        data:{
            msg: sendTxt
        },
        contentType: 'application/x-www-form-urlencoded',
        success:function(data){
             var eventSource = new EventSource('http://localhost:8080/chat/conversation/'+data)
             eventSource.addEventListener('open', function(e) {
                console.log("EventSource连接成功");
             });
             eventSource.addEventListener("message", function(evt){
                var data = evt.data;
                var json = JSON.parse(data);
                var content = json.content ? json.content : '';
                content = content.replaceAll('\n','<br/>');
                console.log(json)
                var outputBody = $('#outputTxt');
                outputBody.html(outputBody.html()+content);
                var outputCard = $('#outputCard');
                var scrollHeight = outputCard[0].scrollHeight;
                outputCard.scrollTop(scrollHeight);
            });
            eventSource.addEventListener('error', function (e) {
                console.log("EventSource异常：" + e)
            });
        }
     });

 })




</script>
</html>